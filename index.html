<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="AuthTHU : 清华大学账号认证Private API">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>AuthTHU</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Epsirom/AuthTHU">View on GitHub</a>

          <h1 id="project_title">AuthTHU</h1>
          <h2 id="project_tagline">清华大学账号认证Private API</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Epsirom/AuthTHU/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Epsirom/AuthTHU/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a name="%E6%AC%A2%E8%BF%8E%E4%BD%BF%E7%94%A8auththu%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E8%B4%A6%E5%8F%B7%E8%AE%A4%E8%AF%81private-api" class="anchor" href="#%E6%AC%A2%E8%BF%8E%E4%BD%BF%E7%94%A8auththu%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E8%B4%A6%E5%8F%B7%E8%AE%A4%E8%AF%81private-api"><span class="octicon octicon-link"></span></a>欢迎使用AuthTHU——清华大学账号认证Private API</h3>

<p>本API为非官方提供，对于使用API可能导致的任何后果，我们一律不负责。</p>

<p>对此我们只能保证：不会保存任何账号信息。</p>

<p>在非清华校园网内，本API不定期开放。在清华校园网内，本API始终开放。</p>

<p><a href="http://auth.igeek.asia" target="_blank">Demo</a></p>

<h3>
<a name="%E4%BD%BF%E7%94%A8auththu%E8%BF%9B%E8%A1%8C%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E8%B4%A6%E5%8F%B7%E8%AE%A4%E8%AF%81" class="anchor" href="#%E4%BD%BF%E7%94%A8auththu%E8%BF%9B%E8%A1%8C%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E8%B4%A6%E5%8F%B7%E8%AE%A4%E8%AF%81"><span class="octicon octicon-link"></span></a>使用AuthTHU进行清华大学账号认证</h3>

<p>向以下URL发送一个POST请求：<code>http://auth.igeek.asia/v1</code></p>

<p>POST请求的Content-Type为<code>application/x-www-form-urlencoded</code>，内容为：</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"secret"</span><span class="p">:</span> <span class="s2">"经加密的包含账号密码信息的密文"</span>
<span class="p">}</span>
</pre></div>

<p>该请求的返回数据格式为json，内容为：</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"code"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Success"</span><span class="p">,</span>
    <span class="nt">"data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"ID"</span><span class="p">,</span>
        <span class="nt">"ID"</span><span class="p">:</span> <span class="s2">"2011013xxx"</span><span class="p">,</span>
        <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"陈华榕"</span><span class="p">,</span>
        <span class="nt">"usertype"</span><span class="p">:</span> <span class="s2">"本科生"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>code</code>为0表示成功，否则表示错误代号。</p>

<p><code>message</code>为错误提示，若成功则为<code>"Success"</code>。此外，它还可能是：<code>"Wrong username or password."</code>或<code>"Unknown error."</code>或<code>Wrong format.</code>或<code>Out of date.</code>，对应的错误代号为<code>1</code>、<code>-1</code>、<code>-2</code>、<code>-3</code>。</p>

<p><code>data</code>只在成功时提供。<code>data.type</code>可能为<code>"ID"</code>或<code>"Email"</code>，前者代表认证的<code>username</code>为学号（或教师工号），后者代表认证的<code>username</code>为校园邮箱账号。<code>data.ID</code>为获取到的该用户的学号（或工号）。<code>data.name</code>为该用户的真实姓名。<code>data.usertype</code>为该用户的类型，如<code>本科生</code>、<code>硕士生</code>等。<code>data.type</code>字段只要认证成功就会提供，其他字段则有一定可能无法提供（因为认证和获取信息是独立的两个步骤，有可能认证成功了但获取信息失败）。</p>

<h4>
<a name="%E5%8A%A0%E5%AF%86%E4%BC%A0%E8%BE%93" class="anchor" href="#%E5%8A%A0%E5%AF%86%E4%BC%A0%E8%BE%93"><span class="octicon octicon-link"></span></a>加密传输</h4>

<p>使用RSA加密传输，公钥为：</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"e"</span><span class="p">:</span> <span class="s2">"0x10001"</span><span class="p">,</span>
    <span class="nt">"n"</span><span class="p">:</span> <span class="s2">"0x89323ab0fba8422ba79b2ef4fb4948ee5158f927f63daebd35c7669fc1af6501ceed5fd13ac1d236d144d39808eb8da53aa0af26b17befd1abd6cfb1dcfba937438e4e95cd061e2ba372d422edbb72979f4ccd32f75503ad70769e299a4143a428380a2bd43c30b0c37fda51d6ee7adbfec1a9d0ad1891e1ae292d8fb992821b"</span>
<span class="p">}</span>
</pre></div>

<p>被加密的字符串格式为<code>时间戳|用户名|密码</code>，即将时间戳、用户名与密码用竖线（<code>|</code>）分隔形成的字符串。将该字符串使用上述公钥加密后就是POST请求的<code>secret</code>密文。</p>

<p><a href="http://auth.igeek.asia/js/RSA.js" target="_blank">点此下载实现RSA的js文件</a></p>

<p>通过以上链接下载的js文件，在前端引入后即可在前端进行加密，关键代码为：</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RSAKeyPair</span><span class="p">(</span><span class="s2">"10001"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"89323ab0fba8422ba79b2ef4fb4948ee5158f927f63daebd35c7669fc1af6501ceed5fd13ac1d236d144d39808eb8da53aa0af26b17befd1abd6cfb1dcfba937438e4e95cd061e2ba372d422edbb72979f4ccd32f75503ad70769e299a4143a428380a2bd43c30b0c37fda51d6ee7adbfec1a9d0ad1891e1ae292d8fb992821b"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">secret</span><span class="o">:</span> <span class="nx">encryptedString</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">timestamp</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">username</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">password</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>

<p>时间戳可以由你的服务器给出，也可GET<code>http://auth.igeek.asia/v1/time</code>得到认证服务器的时间戳。</p>

<p>请注意不要使用用户浏览器的时间戳，因为不能保证用户设备的时间是正确的。</p>

<p>若出现<code>Out of date.</code>错误，说明使用了过时的时间戳进行验证，应更新时间戳后重试。</p>

<h3>
<a name="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" class="anchor" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="octicon octicon-link"></span></a>注意事项</h3>

<p>任何接入本Private API的应用，都有保护用户数据安全的义务！</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">AuthTHU maintained by <a href="https://github.com/Epsirom">Epsirom</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
